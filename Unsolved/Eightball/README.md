# Eightball
Crypto

## Challenge 

Our remote eightball has state of the art encryption protecting the contents of any question asked to it.

nc crypto.2019.chall.actf.co 19000

Author: defund

## Hint
The last 42 characters of the ciphertext is the flag.

## Solution



https://en.wikipedia.org/wiki/Benaloh_cryptosystem
https://en.wikipedia.org/wiki/Goldwasserâ€“Micali_cryptosystem

		der = DerSequence()
		der.decode(binascii.unhexlify(self.query(b'Question: ')))
		question = bytes([benaloh.decrypt(c, sk) for c in der])

The decryption is byte by byte

pk file where n, y = pk

	n = 14807904615725729961916001927171131114356858147937009913468948673786533287843232658429542774502527215733862408245708729887332387608426022498744985706811336269671275679411858812488311434696621785711211442776947213139808006729302984650330668766903194959223024108632929857028919514638550196642603076762641704933251512865686133506310363048887259024770169642630858608323810210264754202678044502917698793177776923761584623439559883550985440313306012523361597478864899169254405458651185180070377582585270455149284956246456640625048223729471859289514829140387477800744685803791904705512189995592189397701259732557154428933933
	y = 14015419378061433327256966712623730189996705685940818252676247689271747630102186036601771833291123172329083982132854576605405924131631445431697959982812856315578238908970592887300220308657524825816213900079022130534781331002090307102931539354615418874685978415407109002852862705909285968448044925354118857342842842811276916895399366011513551939136426300757812174868521930175001791617246874685585722810093118631280983173456294195680555276616720431457985291135493221653530565297416494188157403199513848821150200655563223437874398161021084605822299502795629514149761604581500248103800324727178084619013012053124867000529

Given 

r = 257

	pk = (n, y)
	sk = (n, phi, x)

	x = y^(phi/r)

	c = y^m * u^r

	a = c^(phi/r)

	discrete log
	if x^i == a:
		a == m

Calculate

	a = c^(phi/r) 
	  = (y^m * u^r)^(phi/r)
	  = (y^(m*phi/r) * u^phi)

	x = y^(phi/r)

	x^i = y^(phi/r)^i ==? c^(phi/r)
	x^i = y^(i*phi/r) ==? (y^(m*phi/r)

	

	Find phi such that
	c^(phi/r) % n == 1


https://cryptography.fandom.com/wiki/Benaloh_cryptosystem

> If r is small, we can decrypt z by doing an exhaustive search, i.e. decrypting the messages y^-i * z for i from 1 to r.

where z = (y^m * u^r) == c

	y^(1/i)*c == (y^m * u^r)


## Flag

	??